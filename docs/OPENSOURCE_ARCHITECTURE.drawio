<mxfile host="app.diagrams.net" modified="2024-12-18T00:00:00.000Z" agent="5.0" version="21.0.0">
  <diagram name="Open-Source MPC Architecture" id="opensource-mpc-arch">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="2000" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- Title -->
        <mxCell id="title" value="Open-Source MPC Architecture - AI Search 2.0" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=24;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="300" y="30" width="800" height="50" as="geometry" />
        </mxCell>
        
        <!-- User -->
        <mxCell id="user" value="User&#xa;(Chat Interface)" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="100" y="150" width="40" height="80" as="geometry" />
        </mxCell>
        
        <!-- Application Load Balancer -->
        <mxCell id="alb" value="Application Load Balancer&#xa;(ALB)&#xa;Port 443/80" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontStyle=1;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="250" y="140" width="200" height="100" as="geometry" />
        </mxCell>
        
        <!-- ECS Cluster -->
        <mxCell id="ecs-cluster" value="ECS Cluster&#xa;(MPC API Service)&#xa;Auto-Scaling" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontStyle=1;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="550" y="140" width="220" height="100" as="geometry" />
        </mxCell>
        
        <!-- ECS Tasks -->
        <mxCell id="ecs-task1" value="ECS Task 1&#xa;MPC Service&#xa;Node.js/TypeScript" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="520" y="280" width="140" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="ecs-task2" value="ECS Task 2&#xa;MPC Service&#xa;Node.js/TypeScript" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="680" y="280" width="140" height="80" as="geometry" />
        </mxCell>
        
        <!-- EC2 GPU Instance -->
        <mxCell id="ec2-gpu" value="EC2 Instance&#xa;g4dn.xlarge&#xa;NVIDIA T4 GPU&#xa;16GB RAM" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontStyle=1;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="900" y="140" width="220" height="100" as="geometry" />
        </mxCell>
        
        <!-- Ollama Container -->
        <mxCell id="ollama" value="Ollama Runtime&#xa;Llama 7B Model&#xa;Port 11434" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="920" y="280" width="180" height="80" as="geometry" />
        </mxCell>
        
        <!-- SearxNG Instance -->
        <mxCell id="searxng-ec2" value="EC2 Instance&#xa;t3.small&#xa;2 vCPU, 2GB RAM" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontStyle=1;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="900" y="420" width="220" height="100" as="geometry" />
        </mxCell>
        
        <!-- SearxNG Container -->
        <mxCell id="searxng-container" value="SearxNG Container&#xa;Web Search Aggregator&#xa;Port 8080" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="920" y="560" width="180" height="80" as="geometry" />
        </mxCell>
        
        <!-- RDS PostgreSQL -->
        <mxCell id="rds" value="RDS PostgreSQL&#xa;(UAT Database)&#xa;Read-Only Access" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontStyle=1;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="250" y="420" width="220" height="100" as="geometry" />
        </mxCell>
        
        <!-- Database Tables -->
        <mxCell id="tables" value="Key Tables:&#xa;â€¢ tickets_orders (915 rows)&#xa;â€¢ tickets_orders_items (1,388 rows)&#xa;â€¢ master_ticketing_groups (100M+ rows)&#xa;â€¢ master_events (803K rows)&#xa;â€¢ carts (107K rows)&#xa;â€¢ venues, zones, etc." style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;align=left;verticalAlign=top;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="270" y="560" width="180" height="140" as="geometry" />
        </mxCell>
        
        <!-- MPC Components -->
        <mxCell id="components-box" value="MPC Service Components" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontStyle=1;verticalAlign=top;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="550" y="420" width="280" height="280" as="geometry" />
        </mxCell>
        
        <mxCell id="comp1" value="1. LLM Intent Analyzer&#xa;   (Ollama + Llama 7B)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="570" y="460" width="240" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="comp2" value="2. SQL Agent (LangChain)&#xa;   (Generates SQL dynamically)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="570" y="510" width="240" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="comp3" value="3. Conversation Memory&#xa;   (BufferMemory - stores context)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="570" y="560" width="240" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="comp4" value="4. Response Formatter&#xa;   (Ollama + Llama 7B)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="570" y="610" width="240" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="comp5" value="5. Search Services&#xa;   (Ticket, Event, Price, Location)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="570" y="660" width="240" height="30" as="geometry" />
        </mxCell>
        
        <!-- Arrows -->
        <mxCell id="arrow1" value="HTTPS" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;strokeWidth=2;" edge="1" parent="1" source="user" target="alb">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="400" y="400" as="sourcePoint" />
            <mxPoint x="450" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="arrow2" value="HTTP" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;" edge="1" parent="1" source="alb" target="ecs-cluster">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="400" y="400" as="sourcePoint" />
            <mxPoint x="450" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="arrow3" value="LLM API&#xa;Calls" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;dashed=1;strokeWidth=2;strokeColor=#b85450;" edge="1" parent="1" source="ecs-cluster" target="ec2-gpu">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="400" y="400" as="sourcePoint" />
            <mxPoint x="450" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="arrow4" value="Web Search&#xa;API" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;dashed=1;strokeWidth=2;strokeColor=#9673a6;" edge="1" parent="1" source="ecs-cluster" target="searxng-ec2">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="400" y="400" as="sourcePoint" />
            <mxPoint x="450" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="arrow5" value="SQL Queries&#xa;(Read-Only)" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=2;strokeColor=#82b366;" edge="1" parent="1" source="ecs-cluster" target="rds">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="400" y="400" as="sourcePoint" />
            <mxPoint x="450" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Cost Section -->
        <mxCell id="cost-box" value="Monthly Infrastructure Costs (Open-Source Stack)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontStyle=1;verticalAlign=top;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="250" y="750" width="900" height="180" as="geometry" />
        </mxCell>
        
        <mxCell id="cost1" value="â€¢ EC2 GPU (g4dn.xlarge): $360/month (or $108/month with Spot Instances)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="280" y="790" width="400" height="25" as="geometry" />
        </mxCell>
        
        <mxCell id="cost2" value="â€¢ EC2 SearxNG (t3.small): $15/month" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="280" y="825" width="400" height="25" as="geometry" />
        </mxCell>
        
        <mxCell id="cost3" value="â€¢ ECS Cluster: $20/month (management)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="280" y="860" width="400" height="25" as="geometry" />
        </mxCell>
        
        <mxCell id="cost4" value="â€¢ ALB: $20/month" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="280" y="895" width="400" height="25" as="geometry" />
        </mxCell>
        
        <mxCell id="cost5" value="â€¢ RDS PostgreSQL: Existing (no additional cost)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="720" y="790" width="400" height="25" as="geometry" />
        </mxCell>
        
        <mxCell id="cost-total" value="Total: ~$415/month (standard) or ~$163/month (with Spot)&#xa;vs $3,000+/month for OpenAI API at 100K queries/day" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=13;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="280" y="920" width="840" height="30" as="geometry" />
        </mxCell>
        
        <!-- Technology Stack -->
        <mxCell id="tech-box" value="Open-Source Technology Stack" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontStyle=1;verticalAlign=top;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="250" y="980" width="900" height="200" as="geometry" />
        </mxCell>
        
        <mxCell id="tech1" value="â€¢ LLM: Ollama + Llama 7B / Mistral 7B (open-source models)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="280" y="1020" width="400" height="25" as="geometry" />
        </mxCell>
        
        <mxCell id="tech2" value="â€¢ Web Search: SearxNG (self-hosted metasearch)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="280" y="1055" width="400" height="25" as="geometry" />
        </mxCell>
        
        <mxCell id="tech3" value="â€¢ Database: PostgreSQL RDS (existing)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="280" y="1090" width="400" height="25" as="geometry" />
        </mxCell>
        
        <mxCell id="tech4" value="â€¢ Framework: LangChain (open-source)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="280" y="1125" width="400" height="25" as="geometry" />
        </mxCell>
        
        <mxCell id="tech5" value="â€¢ Runtime: Node.js/TypeScript" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="720" y="1020" width="400" height="25" as="geometry" />
        </mxCell>
        
        <mxCell id="tech6" value="â€¢ Container: Docker + ECS" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="720" y="1055" width="400" height="25" as="geometry" />
        </mxCell>
        
        <mxCell id="tech7" value="â€¢ API: Express.js REST API" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="720" y="1090" width="400" height="25" as="geometry" />
        </mxCell>
        
        <mxCell id="tech8" value="â€¢ All components: 100% open-source" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="720" y="1125" width="400" height="25" as="geometry" />
        </mxCell>
        
        <!-- Flow Labels -->
        <mxCell id="flow1" value="1. User Query" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="105" y="120" width="90" height="20" as="geometry" />
        </mxCell>
        
        <mxCell id="flow2" value="2. Load Balance" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="300" y="120" width="100" height="20" as="geometry" />
        </mxCell>
        
        <mxCell id="flow3" value="3. Process" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="610" y="120" width="100" height="20" as="geometry" />
        </mxCell>
        
        <mxCell id="flow4" value="4. LLM" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="960" y="120" width="100" height="20" as="geometry" />
        </mxCell>
        
        <mxCell id="flow5" value="5. Web" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="960" y="400" width="100" height="20" as="geometry" />
        </mxCell>
        
        <mxCell id="flow6" value="6. Database" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="300" y="400" width="100" height="20" as="geometry" />
        </mxCell>
        
        <!-- Legend -->
        <mxCell id="legend-box" value="Legend" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontStyle=1;verticalAlign=top;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="250" y="1230" width="900" height="120" as="geometry" />
        </mxCell>
        
        <mxCell id="legend-green" value="ðŸŸ¢ Green: Load Balancer / Database Infrastructure" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="280" y="1270" width="400" height="25" as="geometry" />
        </mxCell>
        
        <mxCell id="legend-yellow" value="ðŸŸ¡ Yellow: Application Services (ECS Tasks)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="280" y="1305" width="400" height="25" as="geometry" />
        </mxCell>
        
        <mxCell id="legend-red" value="ðŸ”´ Red: LLM Infrastructure (GPU Instance)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="720" y="1270" width="400" height="25" as="geometry" />
        </mxCell>
        
        <mxCell id="legend-purple" value="ðŸŸ£ Purple: Web Search (SearxNG)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="720" y="1305" width="400" height="25" as="geometry" />
        </mxCell>
        
        <!-- Data Flow Notes -->
        <mxCell id="notes-box" value="Data Flow Notes" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontStyle=1;verticalAlign=top;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="250" y="1400" width="900" height="150" as="geometry" />
        </mxCell>
        
        <mxCell id="note1" value="â€¢ User sends natural language query via HTTPS" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="280" y="1440" width="400" height="20" as="geometry" />
        </mxCell>
        
        <mxCell id="note2" value="â€¢ ALB routes to ECS tasks (auto-scaling)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="280" y="1470" width="400" height="20" as="geometry" />
        </mxCell>
        
        <mxCell id="note3" value="â€¢ MPC Service calls Ollama for LLM processing (intent, SQL, formatting)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="280" y="1500" width="400" height="20" as="geometry" />
        </mxCell>
        
        <mxCell id="note4" value="â€¢ SearxNG aggregates web search results (Google, Bing, DuckDuckGo)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="720" y="1440" width="400" height="20" as="geometry" />
        </mxCell>
        
        <mxCell id="note5" value="â€¢ PostgreSQL returns ticket/seat/event data (read-only)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="720" y="1470" width="400" height="20" as="geometry" />
        </mxCell>
        
        <mxCell id="note6" value="â€¢ Results combined and formatted into natural language response" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="720" y="1500" width="400" height="20" as="geometry" />
        </mxCell>
        
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>

